/* 
Copyright Marcus Parsons 2017-2018
This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
var atf_styles={};function atf(){var g=this;g.o={};var e,y=document.querySelector.bind(document),L=document.querySelectorAll.bind(document);function r(){var e,t,o=[];e=y("#"+g.o.container+"-atf-filterselect").value,t=g.o.caseSensitive?y("#"+g.o.container+"-atf-filtervalue").value:y("#"+g.o.container+"-atf-filtervalue").value.toLowerCase();for(var n=L("#"+g.o.table+" thead > tr > th"),i=0;i<n.length;i++){var a=n[i].innerHTML.trim();o.push(a)}var r=L("#"+g.o.container+"-atf-tbody > tr");if("All"===e)for(i=0;i<r.length;i++){var s=r[i].getElementsByTagName("td"),l=r[i];e:for(var c=0;c<s.length;c++){var d=g.o.caseSensitive?s[c].innerHTML:s[c].innerHTML.toLowerCase();if(-1<d.indexOf(t)){l.classList.remove("hider");break e}c===s.length-1&&l.classList.add("hider")}}else{var f=o.indexOf(e);for(i=0;i<r.length;i++)s=(l=r[i]).getElementsByTagName("td"),-1<(d=!0===g.o.caseSensitive?s[f].innerHTML:s[f].innerHTML.toLowerCase()).indexOf(t)?l.classList.remove("hider"):l.classList.add("hider")}}if(this.update=function(e,t){if(void 0!==t)if("object"==typeof t)switch(e){case"styles":var o,n=Object.keys(t);for(s=0;s<n.length;s++)o=n[s],y("#"+g.o.container).style.hasOwnProperty(o)&&(y("#"+g.o.container).style[o]=t[o])}else switch(g.o[e]=t,e){case"searchText":y("#"+g.o.container+"-atf-filtervalue").setAttribute("placeholder",g.o[e])}},this.removeColumn=function(e){if(e){var t=y("#"+g.o.container+'-atf-filterselect option[value="'+e+'"]');if(t)y("#"+g.o.container+"-atf-filterselect").removeChild(t)}},this.addPagingOpt=function(e){if(void 0!==e&&("string"==typeof e||"number"==typeof e)&&(e="string"==typeof e?parseInt(e,10):e,!isNaN(e))){for(var t=y("#"+g.o.container+"-atf-paging-select"),o=t.querySelectorAll("option"),n=[],i=/^[0-9]+$/,a=!1,r=0;r<o.length;r++)!0===i.test(o[r].innerHTML.trim())&&n.push(+o[r].innerHTML),"ALL"===o[r].innerHTML.toUpperCase()&&(a=!0);for(var s in n.push(e),n.sort(function(e,t){return t<e?1:e<t?-1:0}),a&&n.push("ALL"),t.innerHTML="",n)t.innerHTML+='<option value="'+n[s]+'">'+n[s]+"</option>";if(void 0!==g.o.defaultView){var l=y("#"+g.o.container+'-atf-paging-select option[value="'+g.o.defaultView+'"]');l&&l.setAttribute("selected","selected")}}},this.removePagingOpt=function(e){if(void 0!==e&&("string"==typeof e||"number"==typeof e)){var t=y("#"+g.o.container+'-atf-paging-select option[value="'+e+'"]');if(t&&t.remove(),void 0!==g.o.defaultView&&g.o.defaultView.toString()===e.toString()){var o=L("#"+g.o.container+"-atf-paging-select option");g.o.defaultView=o[0]}}},"object"==typeof arguments[0]&&Object.keys(arguments[0]).length){var t=arguments[0],o=["table","container","submitBy","display","includeLabel","labelText","isToggleableTable","searchText","styles","columnSelect","ignoreRows","caseSensitive","pagination","pagingViews","defaultView","onComplete","removePrevious"],n=Object.keys(t);if(n.indexOf("table")<0)return console.log("Error: no table listed in options given to auto-table-filter.  Please at least specify the table and a container to perform filtering with."),!1;if(n.indexOf("container")<0)return console.log('Error: no container listed in options given to auto-table-filter.  Please specify a container to perform filtering with by specifying its id i.e.\ncontainer: "myContainer".'),!1;for(var s=0;s<o.length;s++){var i=t[o[s]],a=o[s];if(void 0!==i)if(-1<["boolean","string","number","function"].indexOf(typeof i))g.o[a]=i;else if("object"==typeof i)if(i instanceof Array){g.o[a]=[];for(var l=0;l<i.length;l++)g.o[a].push(i[l])}else for(var c in g.o[a]={},i)g.o[a][c]=i[c]}if(!g.o.table)return console.log('Error: please make sure to specify an id for the table being filtered.  Use the same format as the id attribute in HTML i.e. a table with id="myFilteredTable" needs the table property set to "myFilteredTable".'),!1;y("#"+g.o.table+" > tbody").setAttribute("id",g.o.container+"-atf-tbody"),"boolean"!=typeof g.o.removePrevious&&(g.o.removePrevious=!0),(e=g).o.container&&!0===e.o.removePrevious&&(y("#"+e.o.container).innerHTML="",0<L("#"+e.o.container+"-atf-paging-container").length&&y("#"+e.o.container+"-atf-paging-container").parentNode.removeChild(y("#"+e.o.container+"-atf-paging-container"))),g.o.container&&function(a){if(y("#"+a.o.container).classList.add("atf-filter-container"),void 0!==a.o.styles&&"object"==typeof a.o.styles){var e=Object.keys(a.o.styles);for(s=0;s<e.length;s++)y("#"+a.o.container).style.hasOwnProperty([e[s]])&&(y("#"+a.o.container).style[e[s]]=a.o.styles[e[s]])}y("#"+a.o.container).innerHTML=(void 0===a.o.includeLabel||!0===a.o.includeLabel?"<label for='atf-filtervalue'>"+(void 0!==a.o.labelText&&"string"==typeof a.o.labelText?a.o.labelText:"Search:")+"</label> &nbsp;":"")+"<input type='text' class='atf-filtervalue' id='"+a.o.container+"-atf-filtervalue' placeholder='"+(void 0===a.o.searchText||""===a.o.searchText?"Enter a value to search for":a.o.searchText)+"'>",void 0===a.o.columnSelect||!0===a.o.columnSelect?y("#"+a.o.container).innerHTML+="&nbsp; by column &nbsp; <select class='atf-filterselect' id='"+a.o.container+"-atf-filterselect'></select> &nbsp;":y("#"+a.o.container).innerHTML+="<select id='"+a.o.container+"-atf-filterselect' class='hider'></select> &nbsp;","button"===a.o.submitBy&&(y("#"+a.o.container).innerHTML+="<button class='atf-filtersubmit' id='"+a.o.container+"-atf-filtersubmit'>Submit</button>");var t=L("#"+a.o.table+" > thead > tr > th"),o="<option value='All' selected='selected'>All</option>";for(s=0;s<t.length;s++){var n=t[s].innerHTML.trim();""!==n&&(o+="<option value='"+n+"'>"+n+"</option>")}y("#"+a.o.container+"-atf-filterselect").innerHTML=o,y("#"+a.o.container).style.display=void 0!==a.o.display&&""!==a.o.display?a.o.display:"block","button"===a.o.submitBy&&y("#"+a.o.container+"-atf-filtersubmit").addEventListener("click",function(){r()},!1),y("#"+a.o.container+"-atf-filtervalue").addEventListener("keyup",function(e){if(13!==e.which||"button"!==a.o.submitBy&&a.o.submitBy||r(),8===e.which&&""===y("#"+a.o.container+"-atf-filtervalue").value){var t=L("#"+a.o.container+"-atf-tbody > tr");if(void 0===a.o.pagination)for(s=0;s<t.length;s++)t[s].classList.remove("hider");else{var o=y("#"+a.o.container+"-atf-paging-select").options[y("#"+a.o.container+"-atf-paging-select").selectedIndex].text;if("ALL"!==o){var n=+o,i=(+L(".atf-page-number-selected")[0].innerHTML-1)*n;if(void 0!==a.o.isToggleableTable)if(!0===a.o.isToggleableTable){for(s=0;s<2*n;s++)void 0!==t[s]&&t[s].classList.remove("hider");for(s=t.length-1;2*n<=s;s--)void 0!==t[s]&&t[s].classList.add("hider")}else{for(s=t.length-1;0<=s;s--)void 0!==t[s]&&t[s].classList.add("hider");for(s=i;s<i+n;s++)s!==t.length&&void 0!==t[s]&&t[s].classList.remove("hider")}else{for(s=t.length-1;0<=s;s--)t[s].classList.add("hider");for(s=i;s<i+n;s++)s!==t.length&&t[s].classList.remove("hider")}}else for(s=t.length-1;0<=s;s--)t[s].classList.remove("hider")}}"typing"===a.o.submitBy&&""!==y("#"+a.o.container+"-atf-filtervalue").value&&r()},!1)}(g),void 0!==g.o.pagination&&!0===g.o.pagination&&function(b){var u=document.createElement("div");if(u.id=b.o.container+"-atf-paging-container",u.setAttribute("class","atf-paging-container"),y("#"+b.o.container).insertAdjacentElement("afterend",u),void 0===b.o.pagingViews)return console.log("Error: pagination is set to true, but no pagingViews array was given.  Please give an array of values that correspond to the number of items to show when selected.");if(b.o.pagingViews.length<1)return console.log("Error: pagination is set to true, but the pagingViews array was empty.  Please give an array of number values that correspond to the number of items to show when selected (and/or an optional 'ALL' view).");var e=document.createElement("label");e.innerHTML="Show Records: &nbsp;&nbsp;&nbsp;",e.id=b.o.container+"-atf-paging-label",e.setAttribute("for","atf-paging-select"),y("#"+b.o.container+"-atf-paging-container").insertAdjacentElement("beforeend",e);var t,o=document.createElement("select");o.id=b.o.container+"-atf-paging-select",o.setAttribute("class","atf-paging-select"),y("#"+b.o.container+"-atf-paging-label").insertAdjacentElement("afterend",o);for(var n=0;n<b.o.pagingViews.length;n++){var i=document.createElement("option");i.innerHTML=b.o.pagingViews[n],i.value=b.o.pagingViews[n],y("#"+b.o.container+"-atf-paging-select").insertAdjacentElement("beforeend",i)}void 0!==b.o.defaultView&&("string"==typeof b.o.defaultView&&"ALL"!==b.o.defaultView&&(b.o.defaultView=+b.o.defaultView),"ALL"===b.o.defaultView?(t=y("#"+b.o.container+'-atf-paging-select option[value="ALL"]'))&&t.setAttribute("selected","selected"):(b.o.pagingViews.indexOf(b.o.defaultView)<0&&(b.o.defaultView=b.o.pagingViews[0]),(t=y("#"+b.o.container+'-atf-paging-select option[value="'+b.o.defaultView+'"]'))&&t.setAttribute("selected","selected")));var a=y("#"+b.o.container+"-atf-paging-select").options[y("#"+b.o.container+"-atf-paging-select").selectedIndex].text,r=+a,s=L("#"+b.o.container+"-atf-tbody > tr");e:for(var l=0;l<s.length;l++){if(void 0!==b.o.ignoreRows&&"object"==typeof b.o.ignoreRows)for(var c=s[l].classList,d=0;d<b.o.ignoreRows.length;d++)if(c.contains(b.o.ignoreRows[d]))continue e;if("ALL"===a)break;void 0!==b.o.isToggleableTable&&!0===b.o.isToggleableTable?(2*r<=l&&s[l].classList.add("hider"),l++):r<=l&&s[l].classList.add("hider")}var f=(s=L("#"+b.o.container+"-atf-tbody > tr:not(.is-hidden)")).length,g=Math.ceil(f/r),h=document.createElement("div");h.style.display="inline-block",h.classList.add("atf-paging-number-container"),h.id=b.o.container+"-atf-paging-number-container",u.insertAdjacentElement("beforeend",h);for(var p=0;p<g;p++){var v=document.createElement("span");v.classList.add("atf-page-number"),0===p&&v.classList.add("atf-page-number-selected"),v.innerHTML=(p+1).toString(),h.insertAdjacentElement("beforeend",v)}var m=L(".atf-page-number");for(p=0;p<m.length;p++)m[p].addEventListener("click",function(){for(var e=0;e<m.length;e++)m[e].classList.remove("atf-page-number-selected");this.classList.add("atf-page-number-selected");for(var t=+this.innerHTML,o=(t-1)*r,n=t*r-1,i=(s=L("#"+b.o.container+"-atf-tbody > tr:not(.is-hidden)")).length-1;0<=i;i--)o-1<i&&i<n+1?s[i].classList.remove("hider"):s[i].classList.add("hider")});y("#"+b.o.container+"-atf-paging-select").addEventListener("change",function(){for(var e=this.options[this.selectedIndex].text,a=parseInt(e,10),r=L("#"+b.o.container+"-atf-tbody > tr"),t=0;t<r.length;t++)r[t].classList.remove("hider");e:for(t=0;t<r.length;t++){if(void 0!==b.o.ignoreRows&&"object"==typeof b.o.ignoreRows)for(var o=r[t].classList,n=0;n<b.o.ignoreRows.length;n++)if(o.contains(b.o.ignoreRows[n]))continue e;if("ALL"===e)break;void 0!==b.o.isToggleableTable&&!0===b.o.isToggleableTable?(2*a<=t&&r[t].classList.add("hider"),t++):a<=t&&r[t].classList.add("hider")}var i=y("#"+b.o.container+"-atf-paging-number-container");i.parentNode.removeChild(i);var s=(r=L("#"+b.o.container+"-atf-tbody > tr:not(.is-hidden)")).length,l=Math.ceil(s/a),c=document.createElement("div");c.style.display="inline-block",c.classList.add("atf-paging-number-container"),c.id=b.o.container+"-atf-paging-number-container",u.insertAdjacentElement("beforeend",c);for(var d=0;d<l;d++){var f=document.createElement("span");f.classList.add("atf-page-number"),0===d&&f.classList.add("atf-page-number-selected"),f.innerHTML=(d+1).toString(),c.insertAdjacentElement("beforeend",f)}var g=L(".atf-page-number");for(d=0;d<g.length;d++)g[d].addEventListener("click",function(){for(var e=0;e<g.length;e++)g[e].classList.remove("atf-page-number-selected");this.classList.add("atf-page-number-selected");for(var t=parseInt(this.innerHTML,10),o=(t-1)*a,n=t*a-1,i=(r=L("#"+b.o.container+"-atf-tbody > tr:not(.is-hidden)")).length-1;0<=i;i--)o-1<i&&i<n+1?r[i].classList.remove("hider"):r[i].classList.add("hider")})})}(g)}else if("object"!=typeof arguments[0]||void 0===arguments[0])console.log('Error: make sure to pass in a set of {} surrounding your properties like so:\natf({\n  table: "myTable",\n  container: "myContainer",\n  submitBy: "typing"\n});');else if(Object.keys(arguments[0]).length<1)return console.log('Error: no properties listed in the options object given to auto-table-filter.  Please at least specify the table, a container, and submitBy for filtering elements to perform filtering with. Remember to set these to the id values for the elements the same as the HTML id attribute i.e. a table with the id of "myFilteredTable" needs to have "myFilteredTable" passed to auto-table-filter as the table id and same with any other element based options.'),!1;"function"==typeof g.o.onComplete&&g.o.onComplete()}atf_styles.COOLBLUE={background:"#357ebd",color:"white"},atf_styles.BLUESKIES={background:"linear-gradient(to right, #56ccf2, #2f80ed)",color:"white"},atf_styles.CLEARBLACK={background:"none",color:"black"},atf_styles.CLEARWHITE={background:"none",color:"white"},atf_styles.DEEPSEASPACE={background:"linear-gradient(to right, #2c3e50, #4ca1af)",color:"white"},atf_styles.HYDROGEN={background:"linear-gradient(to right, #667db6, #0082c8, #0082c8, #667db6)",color:"white"},atf_styles.LAWRENCIUM={background:"linear-gradient(to right, #0f0c29, #302b63, #24243e)",color:"white"},atf_styles.MILD={background:"linear-gradient(to right, #67b26f, #4ca2cd)",color:"white"},atf_styles.MOONPURPLE={background:"linear-gradient(to right, #4e54c8, #8f94fb)",color:"white"},atf_styles.MOSS={background:"linear-gradient(to right, #134e5e, #71b280)",color:"white"},atf_styles.ONYX={background:"linear-gradient(to bottom, #414345, #232526)",color:"white"},atf_styles.RAINBOWBLUE={background:"linear-gradient(to right, #00f260, #0575e6)",color:"white"},atf_styles.STRIPE={background:"linear-gradient(to right, #1fa2ff, #12d8fa, #a6ffcb)",color:"white"},atf_styles.VENICE={background:"linear-gradient(to right, #6190e8, #a7bfe8)",color:"white"};
