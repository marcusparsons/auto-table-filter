/* 
Copyright Marcus Parsons 2017-2018
This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
function atf(){var g=this;g.o={};var e,L=document.querySelector.bind(document),w=document.querySelectorAll.bind(document);function r(){for(var e=[],t=L("#"+g.o.container+"-atf-filterselect").value,o=g.o.caseSensitive?L("#"+g.o.container+"-atf-filtervalue").value:L("#"+g.o.container+"-atf-filtervalue").value.toLowerCase(),n=w("#"+g.o.table+" thead > tr > th"),i=0;i<n.length;i++){var a=0<n[i].querySelectorAll("*").length?n[i].childNodes[0].valueOf().textContent:n[i].innerText.trim();e.push(a)}var r=w("#"+g.o.container+"-atf-tbody > tr");if("All"===t)for(i=0;i<r.length;i++){var s=r[i].getElementsByTagName("td"),l=r[i];e:for(var c=0;c<s.length;c++){var d=g.o.caseSensitive?s[c].innerHTML:s[c].innerHTML.toLowerCase();if(-1<d.indexOf(o)){l.classList.contains("hider")?l.classList.remove("hider"):g.o.isToggleableTable&&l.previousElementSibling&&l.previousElementSibling.classList.contains("hider")&&l.previousElementSibling.classList.remove("hider");break e}c===s.length-1&&l.classList.add("hider")}}else for(var f=e.indexOf(t),i=0;i<r.length;i++)s=(l=r[i]).getElementsByTagName("td"),-1<(d=!0===g.o.caseSensitive?s[f].innerHTML:s[f].innerHTML.toLowerCase()).indexOf(o)?l.classList.contains("hider")?l.classList.remove("hider"):g.o.isToggleableTable&&l.previousElementSibling&&l.previousElementSibling.classList.contains("hider")&&l.previousElementSibling.classList.remove("hider"):l.classList.add("hider");"function"==typeof g.o.onSearched&&g.o.onSearched()}if(this.styles={},this.styles.COOLBLUE={background:"#357ebd",color:"white"},this.styles.BLUESKIES={background:"linear-gradient(to right, #56ccf2, #2f80ed)",color:"white"},this.styles.CLEARBLACK={background:"none",color:"black"},this.styles.CLEARWHITE={background:"none",color:"white"},this.styles.DEEPSEASPACE={background:"linear-gradient(to right, #2c3e50, #4ca1af)",color:"white"},this.styles.HYDROGEN={background:"linear-gradient(to right, #667db6, #0082c8, #0082c8, #667db6)",color:"white"},this.styles.LAWRENCIUM={background:"linear-gradient(to right, #0f0c29, #302b63, #24243e)",color:"white"},this.styles.MILD={background:"linear-gradient(to right, #67b26f, #4ca2cd)",color:"white"},this.styles.MOONPURPLE={background:"linear-gradient(to right, #4e54c8, #8f94fb)",color:"white"},this.styles.MOSS={background:"linear-gradient(to right, #134e5e, #71b280)",color:"white"},this.styles.ONYX={background:"linear-gradient(to bottom, #414345, #232526)",color:"white"},this.styles.RAINBOWBLUE={background:"linear-gradient(to right, #00f260, #0575e6)",color:"white"},this.styles.STRIPE={background:"linear-gradient(to right, #1fa2ff, #12d8fa, #a6ffcb)",color:"white"},this.styles.VENICE={background:"linear-gradient(to right, #6190e8, #a7bfe8)",color:"white"},this.update=function(e,t){if("object"==typeof t)switch(e){case"styles":var o,n=Object.keys(t);for(s=0;s<n.length;s++)o=n[s],L("#"+g.o.container).style.hasOwnProperty(o)&&(L("#"+g.o.container).style[o]=t[o])}else switch(g.o[e]=t,e){case"searchText":L("#"+g.o.container+"-atf-filtervalue").setAttribute("placeholder",g.o[e])}},this.removeColumn=function(e,t){if(t=t||!1,e){var o="#"+g.o.container+"-atf-filterselect option[value"+(t?"*":"")+'="'+e+'"]',n=w(o);if(0<n.length)for(var i=L("#"+g.o.container+"-atf-filterselect"),a=0;a<n.length;a++){var r=n[a];i.removeChild(r)}}},this.addPagingOpt=function(e){if(("string"==typeof e||"number"==typeof e)&&(e="string"==typeof e?parseInt(e,10):e,!isNaN(e))){for(var t,o=L("#"+g.o.container+"-atf-paging-select"),n=o.querySelectorAll("option"),i=[],a=/^[0-9]+$/,r=!1,s=0;s<n.length;s++)!0===a.test(n[s].innerHTML.trim())&&i.push(+n[s].innerHTML),"ALL"===n[s].innerHTML.toUpperCase()&&(r=!0);for(var l in i.push(e),i.sort(function(e,t){return t<e?1:e<t?-1:0}),r&&i.push("ALL"),o.innerHTML="",i)o.innerHTML+='<option value="'+i[l]+'">'+i[l]+"</option>";void 0===g.o.defaultView||(t=L("#"+g.o.container+'-atf-paging-select option[value="'+g.o.defaultView+'"]'))&&t.setAttribute("selected","selected")}},this.removePagingOpt=function(e){var t,o;"string"!=typeof e&&"number"!=typeof e||((t=L("#"+g.o.container+'-atf-paging-select option[value="'+e+'"]'))&&t.remove(),void 0!==g.o.defaultView&&g.o.defaultView.toString()===e.toString()&&(o=w("#"+g.o.container+"-atf-paging-select option"),g.o.defaultView=o[0]))},"object"==typeof arguments[0]&&Object.keys(arguments[0]).length){var t=arguments[0],o=["table","container","submitBy","display","includeLabel","labelText","isToggleableTable","searchText","styles","columnSelect","ignoreRows","caseSensitive","paging","pagingViews","defaultView","onComplete","onSearched","removePrevious"],n=Object.keys(t);if(n.indexOf("table")<0)return console.error("Error: no table listed in options given to auto-table-filter.  Please at least specify the table and a container to perform filtering with."),!1;if(n.indexOf("container")<0)return console.error('Error: no container listed in options given to auto-table-filter.  Please specify a container to perform filtering with by specifying its id i.e.\ncontainer: "myContainer".'),!1;for(var s=0;s<o.length;s++){var i=t[o[s]],a=o[s];if(void 0!==i)if(-1<["boolean","string","number","function"].indexOf(typeof i))g.o[a]=i;else if("object"==typeof i)if(i instanceof Array){g.o[a]=[];for(var l=0;l<i.length;l++)g.o[a].push(i[l])}else for(var c in g.o[a]={},i)g.o[a][c]=i[c]}if(!g.o.table)return console.error('Error: please make sure to specify an id for the table being filtered.  Use the same format as the id attribute in HTML i.e. a table with id="myFilteredTable" needs the table property set to "myFilteredTable".'),!1;L("#"+g.o.table+" > tbody").setAttribute("id",g.o.container+"-atf-tbody"),function(){for(var e=w("#"+g.o.table+" > tbody > tr"),t=0;t<e.length;t++){e[t].setAttribute("data-atf-index",t)}}(),"boolean"!=typeof g.o.removePrevious&&(g.o.removePrevious=!0),"object"==typeof g.o.ignoreRows&&0<g.o.ignoreRows.length&&(g.o.ignoreRowsSelector=g.o.ignoreRows.map(function(e){return"."+e}).join(",")),(e=g).o.container&&!0===e.o.removePrevious&&(L("#"+e.o.container).innerHTML="",0<w("#"+e.o.container+"-atf-paging-container").length&&L("#"+e.o.container+"-atf-paging-container").parentNode.removeChild(L("#"+e.o.container+"-atf-paging-container"))),g.o.container&&function(a){var e;if(L("#"+a.o.container).classList.add("atf-filter-container"),"string"==typeof a.o.styles)if(a.o.styles=a.o.styles.toUpperCase(),a.styles.hasOwnProperty(a.o.styles))for(e=Object.keys(a.styles[a.o.styles]),s=0;s<e.length;s++)L("#"+a.o.container).style.hasOwnProperty([e[s]])&&(L("#"+a.o.container).style[e[s]]=a.styles[a.o.styles][e[s]]);else if("object"==typeof a.o.styles)for(e=Object.keys(a.o.styles),s=0;s<e.length;s++)L("#"+a.o.container).style.hasOwnProperty([e[s]])&&(L("#"+a.o.container).style[e[s]]=a.o.styles[e[s]]);L("#"+a.o.container).innerHTML=(void 0===a.o.includeLabel||!0===a.o.includeLabel?"<label for='atf-filtervalue'>"+(void 0!==a.o.labelText&&"string"==typeof a.o.labelText?a.o.labelText:"Search:")+"</label> &nbsp;":"")+"<input type='text' class='atf-filtervalue' id='"+a.o.container+"-atf-filtervalue' placeholder='"+(void 0===a.o.searchText||""===a.o.searchText?"Enter a value to search for":a.o.searchText)+"'>",void 0===a.o.columnSelect||!0===a.o.columnSelect?L("#"+a.o.container).innerHTML+="&nbsp; by column &nbsp; <select class='atf-filterselect' id='"+a.o.container+"-atf-filterselect'></select> &nbsp;":L("#"+a.o.container).innerHTML+="<select id='"+a.o.container+"-atf-filterselect' class='hider'></select> &nbsp;","button"===a.o.submitBy&&(L("#"+a.o.container).innerHTML+="<button class='atf-filtersubmit' id='"+a.o.container+"-atf-filtersubmit'>Submit</button>");var t=w("#"+a.o.table+" > thead > tr > th"),o="<option value='All' selected='selected'>All</option>";for(s=0;s<t.length;s++){var n=0<t[s].querySelectorAll("*").length?t[s].childNodes[0].valueOf().textContent:t[s].innerText.trim();""!==n&&(o+="<option value='"+n+"'>"+n+"</option>")}L("#"+a.o.container+"-atf-filterselect").innerHTML=o,L("#"+a.o.container).style.display=void 0!==a.o.display&&""!==a.o.display?a.o.display:"block","button"===a.o.submitBy&&L("#"+a.o.container+"-atf-filtersubmit").addEventListener("click",function(){r()},!1),L("#"+a.o.container+"-atf-filtervalue").addEventListener("keyup",function(e){if(27===e.which&&(L("#"+a.o.container+"-atf-filtervalue").value="",r()),13!==e.which||"button"!==a.o.submitBy&&a.o.submitBy||r(),8===e.which&&""===L("#"+a.o.container+"-atf-filtervalue").value){var t=w("#"+a.o.container+"-atf-tbody > tr");if(void 0===a.o.paging)for(s=0;s<t.length;s++)t[s].classList.remove("hider");else{var o=0<w("#"+a.o.container+"-atf-paging-select").length?L("#"+a.o.container+"-atf-paging-select").options[L("#"+a.o.container+"-atf-paging-select").selectedIndex].text:"ALL";if("ALL"!==o){var n=+o,i=(+w(".atf-page-number-selected")[0].innerHTML-1)*n;if(void 0!==a.o.isToggleableTable)if(!0===a.o.isToggleableTable){for(s=0;s<2*n;s++)void 0!==t[s]&&t[s].classList.remove("hider");for(s=t.length-1;2*n<=s;s--)void 0!==t[s]&&t[s].classList.add("hider")}else{for(s=t.length-1;0<=s;s--)void 0!==t[s]&&t[s].classList.add("hider");for(s=i;s<i+n;s++)s!==t.length&&void 0!==t[s]&&t[s].classList.remove("hider")}else{for(s=t.length-1;0<=s;s--)t[s].classList.add("hider");for(s=i;s<i+n;s++)s!==t.length&&t[s].classList.remove("hider")}}else for(s=t.length-1;0<=s;s--)t[s].classList.remove("hider")}}"typing"===a.o.submitBy&&""!==L("#"+a.o.container+"-atf-filtervalue").value&&r()},!1)}(g),void 0!==g.o.paging&&!0===g.o.paging&&function(b){var u=document.createElement("div");if(u.id=b.o.container+"-atf-paging-container",u.setAttribute("class","atf-paging-container"),L("#"+b.o.container).insertAdjacentElement("afterend",u),void 0!==b.o.pagingViews)if(b.o.pagingViews.length<1)console.error("Error: paging is set to true, but the pagingViews array was empty.  Please give an array of number values that correspond to the number of items to show when selected (and/or an optional 'ALL' view).");else{var e=document.createElement("label");e.innerHTML="Show Records: &nbsp;&nbsp;&nbsp;",e.id=b.o.container+"-atf-paging-label",e.setAttribute("for","atf-paging-select"),L("#"+b.o.container+"-atf-paging-container").insertAdjacentElement("beforeend",e);var t=document.createElement("select");t.id=b.o.container+"-atf-paging-select",t.setAttribute("class","atf-paging-select"),L("#"+b.o.container+"-atf-paging-label").insertAdjacentElement("afterend",t);for(var o,n=0;n<b.o.pagingViews.length;n++){var i=document.createElement("option");i.innerHTML=b.o.pagingViews[n],i.value=b.o.pagingViews[n],L("#"+b.o.container+"-atf-paging-select").insertAdjacentElement("beforeend",i)}void 0!==b.o.defaultView&&("string"==typeof b.o.defaultView&&"ALL"!==b.o.defaultView&&(b.o.defaultView=+b.o.defaultView),"ALL"===b.o.defaultView?(o=L("#"+b.o.container+'-atf-paging-select option[value="ALL"]'))&&o.setAttribute("selected","selected"):(b.o.pagingViews.indexOf(b.o.defaultView)<0&&(b.o.defaultView=b.o.pagingViews[0]),(o=L("#"+b.o.container+'-atf-paging-select option[value="'+b.o.defaultView+'"]'))&&o.setAttribute("selected","selected")));var a=L("#"+b.o.container+"-atf-paging-select").options[L("#"+b.o.container+"-atf-paging-select").selectedIndex].text,r=+a,s=w("#"+b.o.container+"-atf-tbody > tr");e:for(var l=0;l<s.length;l++){if(void 0!==b.o.ignoreRows&&"object"==typeof b.o.ignoreRows)for(var c=s[l].classList,d=0;d<b.o.ignoreRows.length;d++)if(c.contains(b.o.ignoreRows[d]))continue e;if("ALL"===a)break;void 0!==b.o.isToggleableTable&&!0===b.o.isToggleableTable?(2*r<=l&&s[l].classList.add("hider"),l++):r<=l&&s[l].classList.add("hider")}var f="#"+b.o.container+"-atf-tbody > tr";"string"==typeof b.o.ignoreRowsSelector&&(f+=":not("+b.o.ignoreRowsSelector+")");var g=(s=w(f)).length,h=Math.ceil(g/r),p=document.createElement("div");p.style.display="inline-block",p.classList.add("atf-paging-number-container"),p.id=b.o.container+"-atf-paging-number-container",u.insertAdjacentElement("beforeend",p);for(var v=0;v<h;v++){var m=document.createElement("span");m.classList.add("atf-page-number"),0===v&&m.classList.add("atf-page-number-selected"),m.innerHTML=(v+1).toString(),p.insertAdjacentElement("beforeend",m)}for(var y=w(".atf-page-number"),v=0;v<y.length;v++)y[v].addEventListener("click",function(){for(var e=0;e<y.length;e++)y[e].classList.remove("atf-page-number-selected");this.classList.add("atf-page-number-selected");var t=+this.innerHTML,o=(t-1)*r,n=t*r-1,i="#"+b.o.container+"-atf-tbody > tr";"string"==typeof b.o.ignoreRowsSelector&&(i+=":not("+b.o.ignoreRowsSelector+")");for(var a=(s=w(i)).length-1;0<=a;a--)o-1<a&&a<1+n?s[a].classList.remove("hider"):s[a].classList.add("hider")});L("#"+b.o.container+"-atf-paging-select").addEventListener("change",function(){for(var e=this.options[this.selectedIndex].text,r=parseInt(e,10),s=w("#"+b.o.container+"-atf-tbody > tr"),t=0;t<s.length;t++)s[t].classList.remove("hider");e:for(t=0;t<s.length;t++){if(void 0!==b.o.ignoreRows&&"object"==typeof b.o.ignoreRows)for(var o=s[t].classList,n=0;n<b.o.ignoreRows.length;n++)if(o.contains(b.o.ignoreRows[n]))continue e;if("ALL"===e)break;void 0!==b.o.isToggleableTable&&!0===b.o.isToggleableTable?(2*r<=t&&s[t].classList.add("hider"),t++):r<=t&&s[t].classList.add("hider")}var i=L("#"+b.o.container+"-atf-paging-number-container");i.parentNode.removeChild(i);var a="#"+b.o.container+"-atf-tbody > tr";"string"==typeof b.o.ignoreRowsSelector&&(a+=":not("+b.o.ignoreRowsSelector+")");var l=(s=w(a)).length,c=Math.ceil(l/r),d=document.createElement("div");d.style.display="inline-block",d.classList.add("atf-paging-number-container"),d.id=b.o.container+"-atf-paging-number-container",u.insertAdjacentElement("beforeend",d);for(var f=0;f<c;f++){var g=document.createElement("span");g.classList.add("atf-page-number"),0===f&&g.classList.add("atf-page-number-selected"),g.innerHTML=(f+1).toString(),d.insertAdjacentElement("beforeend",g)}for(var h=w(".atf-page-number"),f=0;f<h.length;f++)h[f].addEventListener("click",function(){for(var e=0;e<h.length;e++)h[e].classList.remove("atf-page-number-selected");this.classList.add("atf-page-number-selected");var t=parseInt(this.innerHTML,10),o=(t-1)*r,n=t*r-1,i="#"+b.o.container+"-atf-tbody > tr";"string"==typeof b.o.ignoreRowsSelector&&(i+=":not("+b.o.ignoreRowsSelector+")");for(var a=(s=w(i)).length-1;0<=a;a--)o-1<a&&a<1+n?s[a].classList.remove("hider"):s[a].classList.add("hider")})})}else console.error("Error: paging is set to true, but no pagingViews array was given.  Please give an array of values that correspond to the number of items to show when selected.")}(g)}else if("object"!=typeof arguments[0]||void 0===arguments[0])console.error('Error: make sure to pass in a set of {} surrounding your properties like so:\natf({\n  table: "myTable",\n  container: "myContainer",\n  submitBy: "typing"\n});');else if(Object.keys(arguments[0]).length<1)return console.error('Error: no properties listed in the options object given to auto-table-filter.  Please at least specify the table, a container, and submitBy for filtering elements to perform filtering with. Remember to set these to the id values for the elements the same as the HTML id attribute i.e. a table with the id of "myFilteredTable" needs to have "myFilteredTable" passed to auto-table-filter as the table id and same with any other element based options.'),!1;"function"==typeof g.o.onComplete&&g.o.onComplete()}
