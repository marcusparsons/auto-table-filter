/* 
Copyright Marcus Parsons 2017 to Present
This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
function atf(){const e=this;e.o={};const t=document.querySelector.bind(document),o=document.querySelectorAll.bind(document);function n(){let n,i;const a=[];n=t(`#${e.o.container}-atf-filterselect`).value,i=e.o.caseSensitive?t(`#${e.o.container}-atf-filtervalue`).value:t(`#${e.o.container}-atf-filtervalue`).value.toLowerCase();const r=o(`#${e.o.table} thead > tr > th`);for(let e=0;e<r.length;e++){const t=r[e].querySelectorAll("*").length>0?r[e].childNodes[0].valueOf().textContent:r[e].innerText.trim();a.push(t)}const s=o(`#${e.o.container}-atf-tbody > tr`);if("All"===n)for(let t=0;t<s.length;t++){const o=s[t].getElementsByTagName("td"),n=s[t];e:for(let t=0;t<o.length;t++){if((e.o.caseSensitive?o[t].innerHTML:o[t].innerHTML.toLowerCase()).indexOf(i)>-1){n.classList.contains("hider")?n.classList.remove("hider"):e.o.isToggleableTable&&n.previousElementSibling&&n.previousElementSibling.classList.contains("hider")&&n.previousElementSibling.classList.remove("hider");break e}t===o.length-1&&n.classList.add("hider")}}else{const t=a.indexOf(n);for(let o=0;o<s.length;o++){const n=s[o],a=n.getElementsByTagName("td");(!0===e.o.caseSensitive?a[t].innerHTML:a[t].innerHTML.toLowerCase()).indexOf(i)>-1?n.classList.contains("hider")?n.classList.remove("hider"):e.o.isToggleableTable&&n.previousElementSibling&&n.previousElementSibling.classList.contains("hider")&&n.previousElementSibling.classList.remove("hider"):n.classList.add("hider")}}"function"==typeof e.o.onSearched&&e.o.onSearched()}if(this.styles={},this.styles.COOLBLUE={background:"#357ebd",color:"white"},this.styles.BLUESKIES={background:"linear-gradient(to right, #56ccf2, #2f80ed)",color:"white"},this.styles.CLEARBLACK={background:"none",color:"black"},this.styles.CLEARWHITE={background:"none",color:"white"},this.styles.DEEPSEASPACE={background:"linear-gradient(to right, #2c3e50, #4ca1af)",color:"white"},this.styles.HYDROGEN={background:"linear-gradient(to right, #667db6, #0082c8, #0082c8, #667db6)",color:"white"},this.styles.LAWRENCIUM={background:"linear-gradient(to right, #0f0c29, #302b63, #24243e)",color:"white"},this.styles.MILD={background:"linear-gradient(to right, #67b26f, #4ca2cd)",color:"white"},this.styles.MOONPURPLE={background:"linear-gradient(to right, #4e54c8, #8f94fb)",color:"white"},this.styles.MOSS={background:"linear-gradient(to right, #134e5e, #71b280)",color:"white"},this.styles.ONYX={background:"linear-gradient(to bottom, #414345, #232526)",color:"white"},this.styles.RAINBOWBLUE={background:"linear-gradient(to right, #00f260, #0575e6)",color:"white"},this.styles.STRIPE={background:"linear-gradient(to right, #1fa2ff, #12d8fa, #a6ffcb)",color:"white"},this.styles.VENICE={background:"linear-gradient(to right, #6190e8, #a7bfe8)",color:"white"},this.update=(o,n)=>{if("object"==typeof n)switch(o){case"styles":{const o=Object.keys(n);for(let i=0;i<o.length;i++){const a=o[i],r=t(`#${e.o.container}`);r&&Object.prototype.hasOwnProperty.call(r.style,a)&&(r.style[a]=n[a])}break}}else if(e.o[o]=n,"searchText"===o)t(`#${e.o.container}-atf-filtervalue`).setAttribute("placeholder",e.o[o])},this.removeColumn=(n,i=!1)=>{if(n){const a=`#${e.o.container}-atf-filterselect option[value${i?"*":""}="${n}"]`,r=o(a);if(r.length>0){const o=t(`#${e.o.container}-atf-filterselect`);for(let e=0;e<r.length;e++){const t=r[e];o.removeChild(t)}}}},this.addPagingOpt=o=>{if(("string"==typeof o||"number"==typeof o)&&(o="string"==typeof o?parseInt(o,10):o,!isNaN(o))){const n=t(`#${e.o.container}-atf-paging-select`),i=n.querySelectorAll("option"),a=[],r=/^[0-9]+$/;let s=!1;for(let e=0;e<i.length;e++)!0===r.test(i[e].innerHTML.trim())&&a.push(+i[e].innerHTML),"ALL"===i[e].innerHTML.toUpperCase()&&(s=!0);a.push(o),a.sort(((e,t)=>e>t?1:e<t?-1:0)),s&&a.push("ALL"),n.innerHTML="";for(const e of a)n.innerHTML+=`<option value="${e}">${e}</option>`;if(void 0!==e.o.defaultView){const o=t(`#${e.o.container}-atf-paging-select option[value="${e.o.defaultView}"]`);o&&o.setAttribute("selected","selected")}}},this.removePagingOpt=n=>{if("string"==typeof n||"number"==typeof n){const i=t(`#${e.o.container}-atf-paging-select option[value="${n}"]`);if(i&&i.remove(),void 0!==e.o.defaultView&&e.o.defaultView.toString()===n.toString()){const t=o(`#${e.o.container}-atf-paging-select option`);e.o.defaultView=t[0]}}},"object"==typeof arguments[0]&&Object.keys(arguments[0]).length){const i=arguments[0],a=["table","container","submitBy","display","includeLabel","labelText","isToggleableTable","searchText","styles","columnSelect","ignoreRows","caseSensitive","paging","pagingViews","defaultView","onComplete","onSearched","removePrevious"],r=Object.keys(i);if(r.indexOf("table")<0)return console.error("Error: no table listed in options given to auto-table-filter.  Please at least specify the table and a container to perform filtering with."),!1;if(r.indexOf("container")<0)return console.error('Error: no container listed in options given to auto-table-filter.  Please specify a container to perform filtering with by specifying its id i.e.\ncontainer: "myContainer".'),!1;for(let t=0;t<a.length;t++){const o=i[a[t]],n=a[t];if(void 0!==o)if(["boolean","string","number","function"].indexOf(typeof o)>-1)e.o[n]=o;else if("object"==typeof o)if(o instanceof Array){e.o[n]=[];for(let t=0;t<o.length;t++)e.o[n].push(o[t])}else{e.o[n]={};for(const t in o)Object.prototype.hasOwnProperty.call(o,t)&&(e.o[n][t]=o[t])}}if(!e.o.table)return console.error('Error: please make sure to specify an id for the table being filtered.  Use the same format as the id attribute in HTML i.e. a table with id="myFilteredTable" needs the table property set to "myFilteredTable".'),!1;t(`#${e.o.table} > tbody`).setAttribute("id",`${e.o.container}-atf-tbody`),(()=>{const t=o(`#${e.o.table} > tbody > tr`);for(let e=0;e<t.length;e++){t[e].setAttribute("data-atf-index",e)}})(),"boolean"!=typeof e.o.removePrevious&&(e.o.removePrevious=!0),"object"==typeof e.o.ignoreRows&&e.o.ignoreRows.length>0&&(e.o.ignoreRowsSelector=e.o.ignoreRows.map((e=>`.${e}`)).join(",")),(e=>{if(e.o.container&&!0===e.o.removePrevious&&(t(`#${e.o.container}`).innerHTML="",o(`#${e.o.container}-atf-paging-container`).length>0)){t(`#${e.o.container}-atf-paging-container`).parentNode.removeChild(t(`#${e.o.container}-atf-paging-container`))}})(e),e.o.container&&(e=>{let i;if(t(`#${e.o.container}`).classList.add("atf-filter-container"),"string"==typeof e.o.styles)if(e.o.styles=e.o.styles.toUpperCase(),e.styles.hasOwnProperty(e.o.styles)){i=Object.keys(e.styles[e.o.styles]);for(let o=0;o<i.length;o++){const n=t(`#${e.o.container}`);n&&Object.prototype.hasOwnProperty.call(n.style,i[o])&&(n.style[i[o]]=e.styles[e.o.styles][i[o]])}}else if("object"==typeof e.o.styles){i=Object.keys(e.o.styles);for(let o=0;o<i.length;o++){const n=t(`#${e.o.container}`);n&&Object.prototype.hasOwnProperty.call(n.style,i[o])&&(n.style[i[o]]=e.o.styles[i[o]])}}t(`#${e.o.container}`).innerHTML=(void 0===e.o.includeLabel||!0===e.o.includeLabel?`<label for='atf-filtervalue'>${void 0!==e.o.labelText&&"string"==typeof e.o.labelText?e.o.labelText:"Search:"}</label> &nbsp;`:"")+`<input type='text' class='atf-filtervalue' id='${e.o.container}-atf-filtervalue' placeholder='${void 0===e.o.searchText||""===e.o.searchText?"Enter a value to search for":e.o.searchText}'>`,void 0===e.o.columnSelect||!0===e.o.columnSelect?t(`#${e.o.container}`).innerHTML+=`&nbsp; by column &nbsp; <select class='atf-filterselect' id='${e.o.container}-atf-filterselect'></select> &nbsp;`:t(`#${e.o.container}`).innerHTML+=`<select id='${e.o.container}-atf-filterselect' class='hider'></select> &nbsp;`,"button"===e.o.submitBy&&(t(`#${e.o.container}`).innerHTML+=`<button class='atf-filtersubmit' id='${e.o.container}-atf-filtersubmit'>Submit</button>`);const a=o(`#${e.o.table} > thead > tr > th`);let r="<option value='All' selected='selected'>All</option>";for(let e=0;e<a.length;e++){const t=a[e].querySelectorAll("*").length>0?a[e].childNodes[0].valueOf().textContent:a[e].innerText.trim();""!==t&&(r+=`<option value='${t}'>${t}</option>`)}t(`#${e.o.container}-atf-filterselect`).innerHTML=r,t(`#${e.o.container}`).style.display=void 0!==e.o.display&&""!==e.o.display?e.o.display:"block","button"===e.o.submitBy&&t(`#${e.o.container}-atf-filtersubmit`).addEventListener("click",(()=>{n()}),!1),t(`#${e.o.container}-atf-filtervalue`).addEventListener("keyup",(i=>{if(27===i.which&&(t(`#${e.o.container}-atf-filtervalue`).value="",n()),13!==i.which||"button"!==e.o.submitBy&&e.o.submitBy||n(),8===i.which&&""===t(`#${e.o.container}-atf-filtervalue`).value){const n=o(`#${e.o.container}-atf-tbody > tr`);if(void 0===e.o.paging)for(let e=0;e<n.length;e++)n[e].classList.remove("hider");else{const i=o(`#${e.o.container}-atf-paging-select`).length>0?t(`#${e.o.container}-atf-paging-select`).options[t(`#${e.o.container}-atf-paging-select`).selectedIndex].text:"ALL";if("ALL"!==i){const t=+i,a=(+o(".atf-page-number-selected")[0].innerHTML-1)*t;if(void 0!==e.o.isToggleableTable)if(!0===e.o.isToggleableTable){for(let e=0;e<2*t;e++)void 0!==n[e]&&n[e].classList.remove("hider");for(let e=n.length-1;e>=2*t;e--)void 0!==n[e]&&n[e].classList.add("hider")}else{for(let e=n.length-1;e>=0;e--)void 0!==n[e]&&n[e].classList.add("hider");for(let e=a;e<a+t;e++)e!==n.length&&void 0!==n[e]&&n[e].classList.remove("hider")}else{for(let e=n.length-1;e>=0;e--)n[e].classList.add("hider");for(let e=a;e<a+t;e++)e!==n.length&&n[e].classList.remove("hider")}}else for(let e=n.length-1;e>=0;e--)n[e].classList.remove("hider")}}"typing"===e.o.submitBy&&""!==t(`#${e.o.container}-atf-filtervalue`).value&&n()}),!1)})(e),void 0!==e.o.paging&&!0===e.o.paging&&(e=>{const n=document.createElement("div");if(n.id=`${e.o.container}-atf-paging-container`,n.setAttribute("class","atf-paging-container"),t(`#${e.o.container}`).insertAdjacentElement("afterend",n),void 0===e.o.pagingViews)return console.error("Error: paging is set to true, but no pagingViews array was given.  Please give an array of values that correspond to the number of items to show when selected."),!1;if(e.o.pagingViews.length<1)return console.error("Error: paging is set to true, but the pagingViews array was empty.  Please give an array of number values that correspond to the number of items to show when selected (and/or an optional 'ALL' view)."),!1;{const i=document.createElement("label");i.innerHTML="Show Records: &nbsp;&nbsp;&nbsp;",i.id=`${e.o.container}-atf-paging-label`,i.setAttribute("for","atf-paging-select"),t(`#${e.o.container}-atf-paging-container`).insertAdjacentElement("beforeend",i);const a=document.createElement("select");a.id=`${e.o.container}-atf-paging-select`,a.setAttribute("class","atf-paging-select"),t(`#${e.o.container}-atf-paging-label`).insertAdjacentElement("afterend",a);for(let o=0;o<e.o.pagingViews.length;o++){const n=document.createElement("option");n.innerHTML=e.o.pagingViews[o],n.value=e.o.pagingViews[o],t(`#${e.o.container}-atf-paging-select`).insertAdjacentElement("beforeend",n)}if(void 0!==e.o.defaultView){let o;"string"==typeof e.o.defaultView&&"ALL"!==e.o.defaultView&&(e.o.defaultView=+e.o.defaultView),"ALL"===e.o.defaultView?(o=t(`#${e.o.container}-atf-paging-select option[value="ALL"]`),o&&o.setAttribute("selected","selected")):(e.o.pagingViews.indexOf(e.o.defaultView)<0&&(e.o.defaultView=e.o.pagingViews[0]),o=t(`#${e.o.container}-atf-paging-select option[value="${e.o.defaultView}"]`),o&&o.setAttribute("selected","selected"))}const r=t(`#${e.o.container}-atf-paging-select`).options[t(`#${e.o.container}-atf-paging-select`).selectedIndex].text;let s=+r,l=o(`#${e.o.container}-atf-tbody > tr`);e:for(let t=0;t<l.length;t++){if(void 0!==e.o.ignoreRows&&"object"==typeof e.o.ignoreRows){const o=l[t].classList;for(let t=0;t<e.o.ignoreRows.length;t++)if(o.contains(e.o.ignoreRows[t]))continue e}if("ALL"===r)break;void 0!==e.o.isToggleableTable&&!0===e.o.isToggleableTable?(t>=2*s&&l[t].classList.add("hider"),t++):t>=s&&l[t].classList.add("hider")}let c=`#${e.o.container}-atf-tbody > tr`;"string"==typeof e.o.ignoreRowsSelector&&(c+=`:not(${e.o.ignoreRowsSelector})`),l=o(c);const d=l.length,f=Math.ceil(d/s),g=document.createElement("div");g.style.display="inline-block",g.classList.add("atf-paging-number-container"),g.id=`${e.o.container}-atf-paging-number-container`,n.insertAdjacentElement("beforeend",g);for(let e=0;e<f;e++){const t=document.createElement("span");t.classList.add("atf-page-number"),0===e&&t.classList.add("atf-page-number-selected"),t.innerHTML=(e+1).toString(),g.insertAdjacentElement("beforeend",t)}let b=o(".atf-page-number");for(let t=0;t<b.length;t++)b[t].addEventListener("click",(function(){for(let e=0;e<b.length;e++)b[e].classList.remove("atf-page-number-selected");this.classList.add("atf-page-number-selected");const t=+this.innerHTML,n=(t-1)*s,i=t*s-1;let a=`#${e.o.container}-atf-tbody > tr`;"string"==typeof e.o.ignoreRowsSelector&&(a+=`:not(${e.o.ignoreRowsSelector})`),l=o(a);for(let e=l.length-1;e>=0;e--)e>n-1&&e<i+1?l[e].classList.remove("hider"):l[e].classList.add("hider")}));t(`#${e.o.container}-atf-paging-select`).addEventListener("change",(function(){const i=this.options[this.selectedIndex].text,a=parseInt(i,10);let r=o(`#${e.o.container}-atf-tbody > tr`);for(let e=0;e<r.length;e++)r[e].classList.remove("hider");e:for(let t=0;t<r.length;t++){if(void 0!==e.o.ignoreRows&&"object"==typeof e.o.ignoreRows){const o=r[t].classList;for(let t=0;t<e.o.ignoreRows.length;t++)if(o.contains(e.o.ignoreRows[t]))continue e}if("ALL"===i)break;void 0!==e.o.isToggleableTable&&!0===e.o.isToggleableTable?(t>=2*a&&r[t].classList.add("hider"),t++):t>=a&&r[t].classList.add("hider")}const s=t(`#${e.o.container}-atf-paging-number-container`);s.parentNode.removeChild(s);let l=`#${e.o.container}-atf-tbody > tr`;"string"==typeof e.o.ignoreRowsSelector&&(l+=`:not(${e.o.ignoreRowsSelector})`),r=o(l);const c=r.length,d=Math.ceil(c/a),f=document.createElement("div");f.style.display="inline-block",f.classList.add("atf-paging-number-container"),f.id=`${e.o.container}-atf-paging-number-container`,n.insertAdjacentElement("beforeend",f);for(let e=0;e<d;e++){const t=document.createElement("span");t.classList.add("atf-page-number"),0===e&&t.classList.add("atf-page-number-selected"),t.innerHTML=(e+1).toString(),f.insertAdjacentElement("beforeend",t)}const g=o(".atf-page-number");for(let t=0;t<g.length;t++)g[t].addEventListener("click",(function(){for(let e=0;e<g.length;e++)g[e].classList.remove("atf-page-number-selected");this.classList.add("atf-page-number-selected");const t=parseInt(this.innerHTML,10),n=(t-1)*a,i=t*a-1;let s=`#${e.o.container}-atf-tbody > tr`;"string"==typeof e.o.ignoreRowsSelector&&(s+=`:not(${e.o.ignoreRowsSelector})`),r=o(s);for(let e=r.length-1;e>=0;e--)e>n-1&&e<i+1?r[e].classList.remove("hider"):r[e].classList.add("hider")}))}))}})(e)}else if("object"!=typeof arguments[0]||void 0===arguments[0])console.error('Error: make sure to pass in a set of {} surrounding your properties like so:\natf({\n  table: "myTable",\n  container: "myContainer",\n  submitBy: "typing"\n});');else if(Object.keys(arguments[0]).length<1)return console.error('Error: no properties listed in the options object given to auto-table-filter.  Please at least specify the table, a container, and submitBy for filtering elements to perform filtering with. Remember to set these to the id values for the elements the same as the HTML id attribute i.e. a table with the id of "myFilteredTable" needs to have "myFilteredTable" passed to auto-table-filter as the table id and same with any other element based options.'),!1;"function"==typeof e.o.onComplete&&e.o.onComplete()}